## [MySQL(RPG).](https://joytas.net/programming/mysql/mysql_rpg)
#### 準備
1. 以下のようにデータベースを作成する。
1. 以下のようにパーティーテーブルを作成し、データを挿入する。
1. 以下のようにイベントテーブルを作成し、データを挿入する。
1. 以下のように経験イベントテーブルを作成し、データを挿入する。
1. 以下のようにコードテーブルを作成し、データを挿入する。
1. 上記４つのテーブルを使って以下の問に答えよ。
## LEVLE1
1. 主人公のパーティにいるキャラクターの全データをパーティーテーブルから抽出せよ。
	~~~mysql
	select * from パーティー
	~~~
1. パーティーテーブルから、名称、HP､MPの一覧を取得する。各見出しは次のように表示すること。  
	・なまえ　・現在のHP　・現在のMP
	~~~mysql
	select 名称 as 名前,hp as 現在のHP,mp as 現在のMP from パーティー
	~~~
1. 現在設定されているイベントの全データをイベントテーブルから抽出する。ただし「*｣を用いること
	~~~mysql
	select * from イベント
	~~~
1. イベントテーブルから、イベント番号とイベント名称の一覧を取得する。各見出しは次のように表示すること  
	・番号　・場面
	~~~mysql
	select イベント番号 as 番号, イベント名称 as 場面 from イベント
	~~~
1. パーティーテーブルに、次の３つのデータを追加する。  
	ID：A01、A02、A03  
	名称：スガワラ､オーエ,イズミ  
	職業コード：21、10､20  
	HP:131、156、84  
	MP:232、84、190
	~~~mysql
	insert into パーティー(id,名称,職業コード,hp,mp)values
	('A01','スガワラ',21,131,232),
	('A02','オーエ',10,156,84),
	('A03','イズミ',20,84,190);
	~~~
	## LEVLE2
1. パーティーテーブルから、IDが「C01」のデータを抽出する。
	~~~mysql
	select * from パーティー where id='C01'
	~~~
1. パーティーテーブルのID「A01｣のデータについて、HPを120に更新する。
	~~~mysql
	update パーティー set hp=120 where id='A01'
	~~~
1. ﾊﾟｰﾃｨｰテーブルから、HPが100未満のデータについて、ID,名称、HPの一覧を抽出する。
	~~~mysql
	select id,名称,hp from パーティー where hp<100
	~~~
1. パーティーテーブルから、MPが100以上のデータについてID、名称、MPの一覧を抽出する。
	~~~mysql
	select id,名称,mp from パーティー where mp>=100
	~~~
1. イベントテーブルから、タイプが「特殊」でないデータについて、イベント番号、イベント名称、タイプの一覧を抽出する。
	~~~mysql
	select イベント番号,イベント名称,タイプ from イベント where タイプ<>3
	~~~
1. イベントテーブルから、イベント番号が5以下のデータについて、イベント番号とイベント名称を抽出する。
	~~~mysql
	select イベント番号,イベント名称 from イベント where イベント番号<=5
	~~~
1. イベントテーブルから、イベント番号が20を超過しているデータについて、イベント番号とイベント名称を抽出する。
	~~~mysql
	select イベント番号,イベント名称 from イベント where イベント番号>20
	~~~
1. イベントテーブルから、別のイベントのクリアを前提としないイベントについて、イベント番号とイベント名称を抽出する。
	~~~mysql
	select イベント番号,イベント名称 from イベント where 前提イベント番号 is not null
	~~~
1. イベントテーブルから、次に発生するイベントが決められているイベントについて、イベント番号、イベント名称、後続イベント番号を抽出する。
	~~~mysql
	select イベント番号,イベント名称,後続イベント番号 from イベント
	where 後続イベント番号 is not null
	~~~
1. 名称に「ミ」が含まれるパーティーグループのデータについて、状態コードを「眠り」に更新する。
	~~~mysql
	update パーティー set 状態コード='01' where 名称 like '%ミ%'
	~~~
1. HPが120~160の範囲にあるパーティーテーブルのデータについて、ID,名称、HPの一覧を抽出する。ただし、記述条件は１つであること。
	~~~mysql
	select id,名称,hp from パーティー where hp between 120 and 160
	~~~
1. 職業が「勇者」、「戦士」、「武道家」のいずれかであるパーティーテーブルのデータについて、名称と職業コードを抽出する。ただし、記述する条件式は１つであること
	~~~mysql
	select 名称,職業コード from パーティー
	where 職業コード = '01' or 職業コード ='10' or 職業コード = '11'
	~~~
1. 状態コードが「異常なし」と「気絶」のどちらでもないパーティーグループのデータについて名称と状態コードを抽出する。ただし、記述する条件式は１つであること。
	~~~mysql
	select 名称,状態コード from パーティー where 状態コード <> '00' and 状態コード <> '09'
	~~~
1. パーティーテーブルから、HPとMPがともに100を超えているデータを抽出する。
	~~~mysql
	select * from パーティー where hp > 100 and mp > 100
	~~~
1. パーティーテーブルから、IDが「A」で始まり、職業コードの１文字目が「２」であるデータを抽出する。
	~~~mysql
	select * from パーティー where id like 'a%' and 職業コード like '2%'
	~~~
1. イベントテーブルから、タイプが「強制」で、事前にクリアが必要なイベントで、かつ次に発生するイベントが設定されているデータを抽出する。
	~~~mysql
	select * from イベント
	where タイプ = 1 and 前提イベント番号 is not null and 後続イベント番号 is not null
	~~~
1. パーティーテーブルとイベントテーブルそれぞれについて、主キーの役割を果たしている列名を日本語で解答する。
	~~~mysql
	select id as 識別子 from パーティー
	~~~
	~~~mysql
	select イベント番号 as 識別子 from イベント
	~~~
	## LEVEL3
1. パーティーテーブルから、パーティーの現在の状態コード一覧を取得する。重複は除外すること。
	~~~mysql
	select distinct 状態コード from パーティー
	~~~
1. パーティーテーブルから、IDと名称をIDの昇順に抽出する。
	~~~mysql
	select id,名称 from パーティー order by id asc
	~~~
1. パーティーテーブルから、名称と職業コードを名称の逆順に抽出する。
	~~~mysql
	select 名称,職業コード from パーティー order by 名称 desc
	~~~
1. パーティーテーブルから、名称,HP,状態コードを、状態コードの昇順かつHPの高い順に抽出する。
	~~~mysql
	select 名称,hp,状態コード from パーティー order by 状態コード asc,hp desc
	~~~
1. イベントテーブルから、タイプ、イベント番号、イベント名称、前提イベント番号、後続イベント番号をタイプの昇順かつイベント番号の昇順に抽出する。並び替えには列番号を用いること。  
[Tips]  
ORDER BYの列指定には列番号を用いることができる。  
列番号とは選択列リストにおける列の番号のことで、SELECT命令に記述した順に1から数える。
	~~~mysql
	select タイプ,イベント番号,イベント名称,前提イベント番号,後続イベント番号
	from イベント order by 1 asc,2 asc
	~~~
1. パーティーテーブルから、HPの高い順に3件抽出する。
	~~~mysql
	select * from パーティー order by hp desc limit 3
	~~~
1. パーティーテーブルから、MPが3番目に高いデータを抽出する。
	~~~mysql
	select * from パーティー order by mp desc limit 1 offset 2
	~~~
1. パーティーテーブルから、次の形式の一覧を取得する。
・職業区分 ・職業コード　・ID　・名称
職業区分は、物理攻撃の得意なもの(職業コードが1から始まる)を[S],魔法攻撃の得意なもの(職業コードが2から始まる)を[M],それ以外を[A]と表示すること。また一覧は職業コード順とすること。
	~~~mysql
	select 職業コード,id,名称,
	case when 職業コード like '1%' then 'S'
	when 職業コード like '2%' then 'M'
	else 'A' end as 職業区分 from パーティー order by 職業コード asc
	~~~
1. イベントテーブルと経験イベントテーブルから、まだ参加していないイベント番号を抽出する。イベント番号順に表示すること。  
[tips]
まだ参加していない->経験イベントテーブルあるデータを除外  
副問い合わせを用いWHERE句を以下のように記述するとよい  
WHERE イベント番号 NOT IN(SELECT イベント番号 FROM 経験イベント　WHERE イベント番号)
	~~~mysql
	select * from イベント
	where イベント番号 not in(
	select イベント番号 from 経験イベント where イベント番号)
	~~~
1. イベントテーブルと経験イベントテーブルから、すでにクリアされたイベントのうちタイプがフリーのイベント番号を抽出する。  
[tips]  
すでにクリアされた->経験イベントテーブルある  
副問い合わせを用いWHERE句を以下のように記述するとよい  
WHERE イベント番号 IN(SELECT イベント番号 FROM 経験イベント WHERE クリア区分='1')
AND タイプ = '2'
	~~~mysql
	select * from イベント
	where イベント番号 in(
	select イベント番号 from 経験イベント where クリア区分=1 and タイプ=2)
	~~~
	## LEVEL4
1. アイテム「勇気の鈴」を装備すると、HPが50ポイントアップする。このアイテムを装備したときの各キャラクターのHPを適切な列を用いて次の別名で取得する。ただし、このアイテムは「武道家」と「学者」しか装備できない。  
・なまえ ・現在のHP　・装備後のHP
	~~~mysql
	select 名称 as なまえ,hp as 現在のHP,
	case when 職業コード = 11 then hp+50
	when 職業コード =21 then hp+50
	else '' end as 装備後のHP from パーティー
	~~~
1. ID[A01]と[A03]のキャラクターがアイテム「知恵の指輪」を装備し、MPが20ポイントアップした。その該当データのMPを更新する。
	~~~mysql
	update パーティー set mp=
	case when id='A01' then mp+20
	when id='A03' then mp+20
	else mp+0 end
	~~~
1. 武道家の技「スッキリパンチ」は、自分のHPを2倍したポイントのダメージを敵に与える。この技を使った時のダメージを適切な列を用いて次の別名で抽出する。  
・なまえ ・現在のHP　・予想されるダメージ
	~~~mysql
	select 名称 as なまえ,hp as 現在のHP,
	case when 職業コード='11' then hp*2
	else '' end as 予想されるダメージ from パーティー
	~~~
1. 現在、主人公のパーティーにいるキャラクターの状況について、適切な列を用いて
次の別名で一覧を作成する。  
・なまえ ・HPとMP　・ステータス  
HPとMPはMPを[/]でつなげたもの、ステータスには状態コードを日本語で置き換えたものを表示すること。ただし、ステータスに異常がない場合には何も表示しない。
![](https://joytas.net/wp-content/uploads/2018/02/1.png)  
[Tips]  
ムズイ。コードテーブルをコード種別で絞りんこんでLEFT JOINする。  
SELECT  
〜ここを記述する〜  
FROM パーティー AS p  
LEFT JOIN (SELECT * FROM コード WHERE コード種別=2) AS c  
ON p.状態コード = c.コード値
	- Left Join
	~~~mysql
	select * from パーティー as p
	left join(select * from コード where コード種別=2)as c
	on p.状態コード=c.コード値
	order by id asc
	~~~
	~~~mysql
	select 名称 as なまえ,
	concat(hp,'/',mp)as HPとMP,
	case when コード名称=
	FROM パーティー AS p
	LEFT JOIN (SELECT * FROM コード WHERE コード種別=2) AS c
	ON p.状態コード = c.コード値
	~~~
1. イベントテーブルから、次の形式でイベント一覧を取得する。
・イベント番号　・イベント名称 ・タイプ ・発生時期
タイプはコードを日本語で置き換えたもの、発生時期は次の条件に応じたものを表示すること。
・イベント番号が1から10なら「序盤」
・イベント番号が11から17なら「中盤」
・上記意外なら「終盤」

[Tips]
結合は使わない。CASEで場合分け。
	~~~mysql
	~~~
	~~~mysql
	~~~

38. 敵の攻撃「ネームバリュー」は、名前の文字数を10倍したポイントのダメージがある。
この攻撃を受けた時の各キャラクターの予想ダメージを適切な列を用いて次の別名で取得する。
・なまえ ・現在のHP ・予想ダメージ
	~~~mysql
	~~~
	~~~mysql
	~~~

39. 敵の「四苦八苦」を受け、HPまたはMPが4で割り切れるキャラクターは混乱した。
該当データの状態コードを更新する。なお、剰余の計算には%演算子を用いる
	~~~mysql
	~~~
	~~~mysql
	~~~

40. 町の道具屋で売値が777のアイテム「女神の祝福」を買ったところ、会員証を持っているため30%割引で購入できた。この際に支払った金額を求める。端数は切り捨て。
	~~~mysql
	~~~
	~~~mysql
	~~~
