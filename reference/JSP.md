# JavaServerPage
#### 主なステータスコードと補足メッセージ
ステータスコードと補足メッセージ|意味|
---|---|
200 OK| リクエストが成功した|
404 Not Found|リクエストされた対象が見つからない|
405| Method Not Allowed|リクエスト対象が、使用したリクエストメソッドを許可していない|
500 Internal Server Error|サーバ内部でエラーが発生した|
- Webサーバは、リクエストされた結果どうなったかをステータスコードという数値で返す
#### JSPファイルの特徴
- リクエストして実行する。
- サーブレットクラスに変換され、サーブレットクラスと同じことができる。
- HTMLのなかにJavaのコードを埋め込む。
- サーブレットクラスより楽にHTMLを出力できる。
#### スクリプトレット
スクリプトレットを使うと、JSPファイルにJavaのコードを埋め込むことができる。
#### スクリプトレットの構文
~~~java
<% Javaのコード %>
~~~
#### スクリプト式
変数やメソッドの戻り値などを出力することができる。
#### スクリプト式の構文
＊Javaのコードにセミコロンは不要。
- 出力される内容
~~~java
<%=変数名%> → 変数に代入されている値
<%=演算式%> → 演算結果
<%=オブジェクト.メソッド()%> → メソッドの戻り値
<%=オブジェクト%> → オブジェクト.toString()の戻り値
~~~
#### JSPコメント
~~~java
<%-- ... --%>
~~~
#### pageディレクティブ
JSPファイルに関するさまざまな設定をおこなうことができる。
#### pageディレクティブ設定
~~~java
<%@page 属性名="値"%>
~~~
- 属性(属性名="値")を使って設定を行う。
- 属性は半角スペースで区切ることで複数設定することができる。
#### JSPファイルの保存場所とURL
JSPファイルの正体はサーブレットクラスだが、扱い方はMTMLファイルである。
#### 部品の名前
部品には固有の名前を必ずつける。名前は重複させない。
#### テキストボックスの構文
~~~java
<input type="text" name="名前">
~~~
#### ラジオボタンの構文
~~~java
<input type="radio" name="名前" value="値">
~~~
#### 送信ボタンの構文
~~~java
<input type="submit" value="送信">
~~~
- name属性は必須ではない。
- value属性の値がボタンのラベルとして画面に表示される。
#### GETリクエストとPOSTリクエストの使い分け
- GETリクエストを使う。
	1. リクエストパラメータが、情報を取得するために利用される場合(例:検索)
	1. 送信した結果を保存、共有する場合(例:結果ページのアドレスバーに表示されているURLをブックマークやSNSで利用)
- POSTリクエストを使う。
	1. リクエストパラメータが、情報の登録に利用される場合(例:ユーザー登録や掲示板への投稿)
	1. データをアドレスバーに表示したくない場合(例:個人情報や機密情報の送信)
#### hiddenパラメータ
~~~java
<input type="hidden" name="名前" value="値">
~~~
> この部品は画面に表示されない。
#### リクエスト先の指定に「?名前=値」を付ける
~~~java
<a href="リクエスト先?名前=値">...</a>
<form action="リクエスト先?名前=値" method="post">...</form>
~~~
- 複数送る場合は「&」でつなぐ(例:a=10&b=20)。  
- リンクを使う場合、リンク先のサーブレットクラスはdoGet()を実行する。  
- フォームを使う場合、method="post"とする。
## Link
#### MVCモデルとは
- Model,View,Controllerの頭文字から名前
- Model,View,Controllerの各要素は担当する役割が決められており、他の要素の役割は担いません。

|要素|役割|
|---|---|
|モデル(Model)|アプリケーションの重たる処理(計算処理など)やデータの格納などを行う|
|ビュー(View)|ユーザーに対して画面の表示を行う|
|コントローラ(Controller)|ユーザーからの要求を受け取り、処理の実行をモデルに依頼し、その結果の表示をビューに依頼する|
#### MVC処理の流れ
1. ユーザが、アプリケーションの提供する機能(検索など)を要求する。
1. コントローラが要求を受け付ける。
1. コントローラがモデルに処理の実行を依頼する。
1. モデルが処理を実行する。
1. コントローラが処理結果の表示をビューに依頼する。
1. ビューがユーザーの要求の結果を表示する。
1. ユーザーは要求の結果を見る。
#### MVCモデルとWebアプリケーション
- リクエストを受け取るのはサーブレットクラス(コントローラ)
- レスポンスをするのはJSPファイル(ビュー)
- 処理を担うのは一般的なJavaのクラス(モデル)
#### フォワードとは
フォワードを使用すると、処理を他のサーブレットクラスやJSPファイルに移すことができる。
#### フォワードの構文
~~~java
RequestDispatcher rd= request.getRequestDispatcher("フォワード先");
rd.forward(request,response);
~~~
「javax.servlet.RequestDispatcher」をインポートする必要がある
#### フォワード先の指定方法
JSPファイルの場合 → /WebContentからのパス
サーブレットクラスの場合 → /URLパターン  
フォワード先は同じWebアプリケーションでないとならない。

#### セッションスコープの特徴
- 保存したインスタンスの有効期間は、開発者が決めることができる。
- 保存したインスタンスをレスポンス後も残せるため、リクエストをまたいで利用できる。
#### セッションスコープの所得
~~~java
HttpSession session = request.getSession();
~~~
- javax.servlet.http.HttpSessionをインポートする必要がある。
#### セッションスコープに保存する
~~~java
session.setAttribute("属性名",インスタンス);
~~~
- 第1引数はString型。保存するインスタンスの属性名を指定する。
- 属性名は大文字と小文字を区別する。
- 第2引数はObject型。保存するインスタンスを指定する。第2引数にはあらゆるクラスのインスタンスを指定できる。
- すでに同じ属性名のインスタンスが保存されている場合、上書きされる。
#### セッションスコープからインスタンスを取得する
~~~java
取得するインスタンスの型 変数名=(取得するインスタンスの型)session.getAttribute("属性名");
~~~
- 引数はString型。取得するインスタンスの属性名を引数で指定する。
- 属性名は大文字と小文字を区別する。
- 戻り値はObject型。取得したインスタンスが返される。
- 取得したインスタンスは元の型にキャストする必要がある。
- 指定した属性名のインスタンスが保存されていない場合「null」を返す。
#### セッションスコープからインスタンスを削除する
~~~java
session.removeAttribute("属性名");
~~~
- 引数はString型。削除するインスタンスの属性名を引数で指定する。
- 属性名は大文字と小文字を区別する。
#### JSPファイルでセッションスコープを使う場合は、暗黙オブジェクト「session」を使用します。
|オブジェクトの型名|オブジェクトの型|
|---|---|
|request|javax.servlet.http.HttpServletRequest|
|session|javax.servlet.http.HttpSession|
|application|javax.servlet.ServletContext|  
#### セッションID
- HttpSessionインスタンスはユーザー(ブラウザ)ごとに作成される。
- getSession()を実行すると内部でセッションIDが新たに発行される。
#### セッションIDとクッキー
- クッキー(Cookie)とはWebサーバがブラウザにデータを保存、送信させるしくみ。
- クッキーには有効期限を設定することができる。
- 特別な設定をしない限り、アプリケーションサーバはブラウザが閉じられるまでをセッションIDの有効期限とする。
- 予期しない動作を防ぐため、セッションスコープを使ったプログラムの動作を確認する際には、必ずブラウザのウィンドウをすべて閉じてから行うようにする。
 教科書 セッションスコープの注意点 P237~のつづき
#### セッションのタイムアウト
- HttpSessionインスタンスは他のインスタンスとは異なり、使用されない状態になっても、すぐにはガベージコレクションの対象にはならない。
> HttpSessionインスタンスが不要になったことをサーバが判断できないため。
- セッションタイムアウト
一定時間利用されていないHttpSessionインスタンスについては不要と判断し、ガベージコレクションの対象とする。
> Apache Tomcatの場合、デフォルトで30分。
#### セッションスコープを破棄する
~~~java
session.invalidate();
~~~
- スコープ自体が破壊され、保存していたすべてのインスタンスが消滅する。
- 実行後に再度getSession()を実行すると、新しいHttpSessionインスタンスが生成される。
#### ステートフルな通信
リクエストをまたいでユーザーの情報を保持する通信のことを「ステートフル」な通信、反対にリクエストをまたいで情報を保持できない通信を「ステートレス」な通信という。
#### セッションスコープと直列化
アプリケーションサーバは、停止時にセッションスコープ内のインスタンスを直列化してファイルに保存し、再起動時にはそのファイルからインスタンスの復元を行います。これによりサーバを再起動しても、ユーザー(ブラウザ)は、再起動前の状態のセッションスコープを利用することができる。
 教科書 アプリケーションスコープ P246~
 教科書 アプリケーションスコープ P246~のつづき
#### アプリケーションスコープの特徴
Webアプリケーションが終了するまでの間、アプリケーション内のすべてのサーブレットクラスとJSPファイルで利用することができる。
#### アプリケーションスコープの取得
~~~java
ServletContext application=this.getServletContext();
~~~
- javax.servlet.ServletContextをインポートする必要がある。
- 「this」は省略可能。
#### アプリケーションスコープに保存する
~~~java
application.setAttribute("属性名",インスタンス);
~~~
- 第1引数はString型。保存するインスタンスの属性名を指定する。
- 属性名は大文字と小文字を区別する。
- 第2引数はObject型。保存するインスタンスを指定する。第2引数にはあらゆるクラスのインスタンスを指定できる。
- すでに同じ属性名のインスタンスが保存されている場合、上書きされる。
#### アプリケーションスコープからインスタンスを取得する
~~~java
取得するインスタンスの型 変数名=(取得するインスタンスの型)application.getAttrivute("属性名");
~~~
- 引数はString型。取得するインスタンスの属性名を指定する。
- 属性名は大文字と小文字を区別する。
- 戻り値はObject型。取得したインスタンスが返される。
- 取得したインスタンスは元の型にキャストする必要がある。
- 指定した属性名のインスタンスが保存されていない場合「null」を返す。
#### アプリケーションスコープからインスタンスを削除する
~~~java
application.removeAttribute("属性名");
~~~
- 引数はString型。削除するインスタンスの属性名を引数で指定する。
- 属性名は大文字と小文字を区別する。
#### リダイレクトとは
ブラウザのリクエスト先を変更して処理の転送を行う。
#### リダイレクトの構文
~~~java
response.sendRedirect("リダイレクト先のURL");
~~~
- リダイレクト先は、ブラウザがリクエストできる先であればどこでも可
#### リダイレクト先の記述方法(同じアプリケーションサーバにある場合)
- サーブレットクラスの場合→ /アプリケーション名/URLパターン
- JSPファイルの場合 → /アプリケーション名/WebContentからのパス
#### 転送後のURLの違い
- フォワード後 →URLはリクエスト時のまま。
- リダイレクト後 →リダイレクト先のURLに変更。
Link
1. [bootstrap4.](https://joytas.net/programming/website/bootstrap4)  
- cssフレームワーク
デザインやレイアウトの手助けとなるツール
> 他にもいろいろある

